<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TODO App</title>
    <style>
        /* Estilos básicos para centrar y dar un poco de orden */
        body {
            font-family: sans-serif;
            max-width: 500px;
            margin: 50px auto;
            text-align: center;
        }

        form {
            margin-bottom: 20px;
        }

        ul {
            padding: 0;
            list-style: none;
        }

        li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #ccc;
        }

        .tarea-completada {
            text-decoration: line-through;
            color: gray;
        }

        .texto {
            flex-grow: 1;
            text-align: left;
            margin-left: 10px;
        }

        button.eliminar {
            background-color: red;
            color: white;
            border: none;
            padding: 4px 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>Lista de Tareas</h1>

<!-- Formulario para crear tarea -->
<form id="formulario">
    <input type="text" id="tarea" placeholder="Escribe una tarea" required>
    <button type="submit">Agregar</button>
</form>

<ul id="tareas"></ul>

<script>
    const apiUrl = '/api/todos';

    // Su objetivo es cargar todas las tareas existentes desde el backend y
    // mostrarlas en la interfaz.
    window.onload = function () {
        //Hace una solicitud GET a /api/todos
        fetch(apiUrl)
            //Convierte la respuesta en un objeto que JavaScript puede usar (arreglo de tareas).
            .then(res => res.json())
            //Aquí se recorren todas las tareas recibidas para mostrarlas en pantalla.
            .then(tareas => {
                //Busca el elemento <ul id="tareas"> para agregarle tareas como <li>.
                const lista = document.getElementById('tareas');
                //Limpia la lista antes de volver a cargarla (evita duplicados).
                lista.innerHTML = '';

                //Itera sobre cada tarea (t) recibida desde el backend para crear un elemento visual.
                tareas.forEach(t => {
                    const li = document.createElement('li');

                    // Checkbox para completar/descompletar 
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    //Si la tarea está completada (t.completado === true), el checkbox aparece marcado.
                    checkbox.checked = t.completado;

                    // Texto de la tarea
                    const texto = document.createElement('span');
                    texto.textContent = t.tarea;
                    texto.className = 'texto';
                    //Si está completada, se le aplica una clase CSS para tacharla
                    // (por ejemplo, con text-decoration: line-through).
                    if (t.completado) {
                        texto.classList.add('tarea-completada');
                    }

                    // Botón para eliminar
                    const botonEliminar = document.createElement('button');
                    botonEliminar.textContent = 'Eliminar';
                    botonEliminar.className = 'eliminar';
                    //Al hacer clic, hace una petición DELETE al backend usando el id de la tarea.
                    botonEliminar.onclick = () => {
                        fetch(`${apiUrl}/${t.id}`, {
                            method: 'DELETE'
                        }).then(() => location.reload()); // Luego recarga la página para actualizar la lista.
                    };

                    // Al cambiar el checkbox, actualiza completado
                    //Cada vez que el usuario marca o desmarca el checkbox, se hace una petición PUT
                    // para cambiar el estado de completado.
                    checkbox.onchange = () => {
                        fetch(`${apiUrl}/${t.id}/completar`, {
                            method: 'PUT'
                        }).then(() => location.reload()); //Luego recarga la página para reflejar el nuevo estado.
                    };

                    // Agrega elementos al <li> y luego a la lista
                    li.appendChild(checkbox);
                    li.appendChild(texto);
                    li.appendChild(botonEliminar);
                    lista.appendChild(li);
                });
            });
    };

    // Enviar nueva tarea
    document.getElementById('formulario').onsubmit = function (e) {
        e.preventDefault();
        //Se obtiene el valor del campo de texto (#tarea).
        const texto = document.getElementById('tarea').value;

        //petición POST al backend para crear la nueva tarea.
        fetch(apiUrl, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({tarea: texto})
        }).then(() => location.reload()); // recarga la página para mostrar la nueva tarea.
    };
</script>
</body>
</html>
